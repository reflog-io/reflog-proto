syntax = "proto3";

package reflog.v1;

import "options.proto";

message User {
  string id = 1;
  string name = 2;
  string email = 3;

  message Profile {
    string display_name = 1;
    string avatar_url = 2;
    string bio = 3;
    int64 created_at = 4;
  }

  Profile profile = 4;
}

message Article {
  string id = 1;

  string author_id = 2 [
    (reflog.v1.foreign_key) = "User.id",
    (reflog.v1.relationship_type) = "many_to_one"
  ];

  string title = 3;
  string body = 4;

  message Metadata {
    repeated string tags = 1;
    bool published = 2;
    int64 published_at = 3;
    int64 updated_at = 4;
  }

  Metadata metadata = 5;
}

message Comment {
  string id = 1;

  string article_id = 2 [
    (reflog.v1.foreign_key) = "Article.id",
    (reflog.v1.relationship_type) = "many_to_one"
  ];

  string user_id = 3 [
    (reflog.v1.foreign_key) = "User.id",
    (reflog.v1.relationship_type) = "many_to_one"
  ];

  string comment = 4;
  int64 created_at = 5;

  message Reaction {
    string user_id = 1 [
      (reflog.v1.foreign_key) = "User.id",
      (reflog.v1.relationship_type) = "many_to_one"
    ];
    string type = 2; // "like", "laugh", "angry", etc
    int64 reacted_at = 3;
  }

  repeated Reaction reactions = 6;
}
